<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>`bayesmsm` for longitudinal data without right-censoring • bayesmsm</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="`bayesmsm` for longitudinal data without right-censoring">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">bayesmsm</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/bayesmsm-censoring.html">`bayesmsm` for longitudinal data with informative right-censoring</a></li>
    <li><a class="dropdown-item" href="../articles/bayesmsm-nocensoring.html">`bayesmsm` for longitudinal data without right-censoring</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/Kuan-Liu-Lab/bayesmsm/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>`bayesmsm` for longitudinal data without right-censoring</h1>
                        <h4 data-toc-skip class="author">Xiao Yan, Kuan
Liu</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/Kuan-Liu-Lab/bayesmsm/blob/main/vignettes/bayesmsm-nocensoring.Rmd" class="external-link"><code>vignettes/bayesmsm-nocensoring.Rmd</code></a></small>
      <div class="d-none name"><code>bayesmsm-nocensoring.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<ul>
<li>
<p>The <code>bayesmsm</code> package enables easy implementation of
the Bayesian marginal structural models (BMSMs) for longitudinal data.
The methodology of BMSMs can be divided into 2 estimation steps:</p>
<ul>
<li>Step 1. Bayesian treatment effect weight estimation</li>
<li>Step 2. Bayesian non-parametric bootstrap to maximize the utility
function with respect to the causal effect</li>
</ul>
</li>
<li><p>For Step 1, we estimate treatment weights
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>w</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><annotation encoding="application/x-tex">w_{ij}</annotation></semantics></math>
using posterior samples of the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>α</mi><annotation encoding="application/x-tex">\alpha</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>β</mi><annotation encoding="application/x-tex">\beta</annotation></semantics></math>
via fitting a series of logistic regressions in a Bayesian framework.
The package is able to handle longitudinal data without and with
right-censoring. For Step 2,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>P</mi><mi>n</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>v</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">P_n(v_{ij})</annotation></semantics></math>
is estimated via non-parametric Bayesian bootstrap with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>D</mi><mi>i</mi><mi>r</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>,</mo><mi>.</mi><mi>.</mi><mi>.</mi><mo>,</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">Dir(1,...,1)</annotation></semantics></math>
sampling weights.</p></li>
<li>
<p>The main functions in this package include:</p>
<ul>
<li>
<code>bayesweight</code>: Calculates Bayesian weights for
subject-specific treatment effects.</li>
<li>
<code>bayesweight_cen</code>: Calculates Bayesian weights for
subject-specific treatment effects with right-censored data.</li>
<li>
<code>bayesmsm</code>: Estimates marginal structural models using
the calculated Bayesian weights.</li>
<li>
<code>plot_ATE</code>: Plots the estimated Average Treatment Effect
(ATE).</li>
<li>
<code>plot_APO</code>: Plots the estimated Average Potential Outcome
(APO).</li>
<li>
<code>plot_est_box</code>: Plots the distribution of estimated
treatment effects.</li>
<li>
<code>summary_bayesmsm</code>: Summarizes the model results from
<code>bayesmsm</code>.</li>
</ul>
</li>
<li>
<p>Installation</p>
<ul>
<li>To install the bayesmsm package, you can use the
<code>devtools</code> package to install it directly from GitHub.</li>
</ul>
</li>
</ul>
</div>
<div class="section level2">
<h2 id="simulated-observational-data-with-a-time-dependent-treatment">Simulated observational data with a time-dependent treatment<a class="anchor" aria-label="anchor" href="#simulated-observational-data-with-a-time-dependent-treatment"></a>
</h2>
<p>We illustrate the implementation of the <code>bayesmsm</code> package
using a simulated dataset. The simulated dataset contains
right-censoring with a binary end-of-study outcome. This example will
provide a comprehensive understanding of how to apply the package to
real-world data.</p>
</div>
<div class="section level2">
<h2 id="dataset-introduction">Dataset Introduction<a class="anchor" aria-label="anchor" href="#dataset-introduction"></a>
</h2>
<p>In this simulation study, we use a simulated longitudinal dataset to
mimic complex real-world clinical data without right-censoring. This
dataset consists of 500 patients observed over 3 visits. The binary
outcome variable represents the end-of-study status of the patients. The
dataset includes baseline covariates
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>L</mi><mn>11</mn></mrow><annotation encoding="application/x-tex">L11</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>L</mi><mn>21</mn></mrow><annotation encoding="application/x-tex">L21</annotation></semantics></math>,
with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>L</mi><mn>11</mn></mrow><annotation encoding="application/x-tex">L11</annotation></semantics></math>
being binary and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>L</mi><mn>21</mn></mrow><annotation encoding="application/x-tex">L21</annotation></semantics></math>
continuous. Time-dependent covariates
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>L</mi><mn>12</mn></mrow><annotation encoding="application/x-tex">L12</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>L</mi><mn>22</mn></mrow><annotation encoding="application/x-tex">L22</annotation></semantics></math>
are observed at the second visit, and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>L</mi><mn>13</mn></mrow><annotation encoding="application/x-tex">L13</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>L</mi><mn>23</mn></mrow><annotation encoding="application/x-tex">L23</annotation></semantics></math>
at the third visit. The treatment variables are represented as
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi><mn>1</mn></mrow><annotation encoding="application/x-tex">A1</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi><mn>2</mn></mrow><annotation encoding="application/x-tex">A2</annotation></semantics></math>,
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi><mn>3</mn></mrow><annotation encoding="application/x-tex">A3</annotation></semantics></math>
for the three visits.</p>
<table class="table">
<caption>Description of Simulated Dataset</caption>
<thead><tr class="header">
<th>Variable</th>
<th>Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>L11</td>
<td>Baseline covariate (binary)</td>
</tr>
<tr class="even">
<td>L21</td>
<td>Baseline covariate (continuous)</td>
</tr>
<tr class="odd">
<td>A1, A2, A3</td>
<td>Treatment assignments (binary)</td>
</tr>
<tr class="even">
<td>Y</td>
<td>End-of-study outcome (binary)</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Example simulated causal data without censoring</span></span>
<span><span class="va">simdat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>,</span>
<span>                               <span class="st">"sim_causal.csv"</span>,</span>
<span>                               package <span class="op">=</span> <span class="st">"bayesmsm"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Look at the data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">simdat</span><span class="op">)</span></span>
<span><span class="co">#&gt;   L11         L21 A1 L12        L22 A2 L13         L23 A3 C Y</span></span>
<span><span class="co">#&gt; 1   0 -0.37560287  0   1  0.8638998  1   1 -0.94685770  1 0 0</span></span>
<span><span class="co">#&gt; 2   1 -0.56187636  0   1  0.1419673  1   1 -0.05470362  1 0 0</span></span>
<span><span class="co">#&gt; 3   0 -0.34391723  1   1 -0.2383382  0   1 -1.02368364  1 0 1</span></span>
<span><span class="co">#&gt; 4   1  0.09049665  1   1 -0.2686672  1   1 -1.36831768  1 0 1</span></span>
<span><span class="co">#&gt; 5   1  1.59850877  0   1  1.8905777  1   1  1.01967345  1 0 0</span></span>
<span><span class="co">#&gt; 6   0 -0.08856511  0   0 -1.0465424  0   1 -0.99889261  0 0 1</span></span></code></pre></div>
<ul>
<li>Frequency Counts by Treatment Combinations</li>
</ul>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># frequency counts by treatment combinations;</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">simdat</span><span class="op">$</span><span class="va">A1</span>, <span class="va">simdat</span><span class="op">$</span><span class="va">A2</span>, <span class="va">simdat</span><span class="op">$</span><span class="va">A3</span><span class="op">)</span></span>
<span><span class="co">#&gt; , ,  = 0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;    </span></span>
<span><span class="co">#&gt;       0   1</span></span>
<span><span class="co">#&gt;   0  47  40</span></span>
<span><span class="co">#&gt;   1  38  63</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; , ,  = 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;    </span></span>
<span><span class="co">#&gt;       0   1</span></span>
<span><span class="co">#&gt;   0  51  79</span></span>
<span><span class="co">#&gt;   1  70 112</span></span></code></pre></div>
<ul>
<li>Suppose the causal parameter of interest is the average treatment
effect between always treated and never treated,</li>
</ul>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi><mi>T</mi><mi>E</mi><mo>=</mo><mi>E</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>Y</mi><mo>∣</mo><msub><mi>A</mi><mn>1</mn></msub><mo>=</mo><mn>1</mn><mo>,</mo><msub><mi>A</mi><mn>2</mn></msub><mo>=</mo><mn>1</mn><mo>,</mo><msub><mi>A</mi><mn>3</mn></msub><mo>=</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow><mo>−</mo><mi>E</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>Y</mi><mo>∣</mo><msub><mi>A</mi><mn>1</mn></msub><mo>=</mo><mn>0</mn><mo>,</mo><msub><mi>A</mi><mn>2</mn></msub><mo>=</mo><mn>0</mn><mo>,</mo><msub><mi>A</mi><mn>3</mn></msub><mo>=</mo><mn>0</mn><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">
ATE = E(Y \mid A_1 = 1, A_2 = 1, A_3 = 1) - E(Y \mid A_1 = 0, A_2 = 0, A_3 = 0)
</annotation></semantics></math></p>
</div>
<div class="section level2">
<h2 id="bayesian-treatment-effect-weight-estimation-using-bayesweight">Bayesian treatment effect weight estimation using
<code>bayesweight</code><a class="anchor" aria-label="anchor" href="#bayesian-treatment-effect-weight-estimation-using-bayesweight"></a>
</h2>
<ul>
<li>The following code calls the function <code>bayesweight</code> to
run JAGS and calculate the weights.
<ul>
<li>Non-parallel computing requires that <code>n.chains = 1</code>.
Parallel MCMC requires at least 2 chains because computing is running on
1 core per chain, and we recommend using at most 2 chains less than the
number of available cores on your computer.</li>
<li>Running this function automatically saves a JAGS model file in the
working directory, which the user can check to review the model
specifications.</li>
</ul>
</li>
<li>Parameters Description:
<ul>
<li>
<code>trtmodel.list</code>: A list of formulas corresponding to each
time point with the time-specific treatment variable on the left hand
side and pre-treatment covariates to be balanced on the right hand side.
Interactions and functions of covariates are allowed.</li>
<li>
<code>data</code>: The dataset containing all the variables
specified in trtmodel.list.</li>
<li>
<code>n.chains</code>: Number of MCMC chains to run. For
non-parallel execution, this should be set to 1. For parallel execution,
it requires at least 2 chains.</li>
<li>
<code>n.iter</code>: Total number of iterations for each chain
(including burn-in).</li>
<li>
<code>n.burnin</code>: Number of iterations to discard at the
beginning of the simulation (burn-in).</li>
<li>
<code>n.thin</code>: Thinning rate for the MCMC sampler.</li>
<li>
<code>seed</code>: Seed to ensure reproducibility.</li>
<li>
<code>parallel</code>: Logical flag indicating whether to run the
MCMC chains in parallel. Default is TRUE.</li>
</ul>
</li>
</ul>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">weights</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bayesweight.html">bayesweight</a></span><span class="op">(</span></span>
<span>  trtmodel.list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="va">A1</span> <span class="op">~</span> <span class="va">L11</span> <span class="op">+</span> <span class="va">L21</span>,</span>
<span>    <span class="va">A2</span> <span class="op">~</span> <span class="va">L11</span> <span class="op">+</span> <span class="va">L21</span> <span class="op">+</span> <span class="va">L12</span> <span class="op">+</span> <span class="va">L22</span> <span class="op">+</span> <span class="va">A1</span>,</span>
<span>    <span class="va">A3</span> <span class="op">~</span> <span class="va">L11</span> <span class="op">+</span> <span class="va">L21</span> <span class="op">+</span> <span class="va">L12</span> <span class="op">+</span> <span class="va">L22</span> <span class="op">+</span> <span class="va">A1</span> <span class="op">+</span> <span class="va">L13</span> <span class="op">+</span> <span class="va">L23</span> <span class="op">+</span> <span class="va">A2</span></span>
<span>  <span class="op">)</span>,</span>
<span>  data <span class="op">=</span> <span class="va">simdat</span>,</span>
<span>  n.chains <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  n.iter <span class="op">=</span> <span class="fl">250</span>,</span>
<span>  n.burnin <span class="op">=</span> <span class="fl">150</span>,</span>
<span>  n.thin <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  seed <span class="op">=</span> <span class="fl">890123</span>,</span>
<span>  parallel <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Compiling model graph</span></span>
<span><span class="co">#&gt;    Resolving undeclared variables</span></span>
<span><span class="co">#&gt;    Allocating nodes</span></span>
<span><span class="co">#&gt; Graph information:</span></span>
<span><span class="co">#&gt;    Observed stochastic nodes: 3000</span></span>
<span><span class="co">#&gt;    Unobserved stochastic nodes: 24</span></span>
<span><span class="co">#&gt;    Total graph size: 13068</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Initializing model</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">weights</span><span class="op">)</span></span>
<span><span class="co">#&gt;              Length Class  Mode     </span></span>
<span><span class="co">#&gt; weights      500    -none- numeric  </span></span>
<span><span class="co">#&gt; model_string   1    -none- character</span></span></code></pre></div>
<ul>
<li>It returns a list containing:
<ul>
<li>
<code>weights</code>: The calculated weights for subject-specific
treatment effects, computed by taking the average of the weights across
all MCMC iterations.</li>
<li>
<code>model_string</code>: A character of the JAGS model based on
input of the argument trtmodel.list.</li>
</ul>
</li>
<li>We can print and view the JAGS model stored in
<code>model_string</code> from the above function output:</li>
</ul>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="va">weights</span><span class="op">$</span><span class="va">model_string</span><span class="op">)</span></span>
<span><span class="co">#&gt; model{</span></span>
<span><span class="co">#&gt; #N = nobs</span></span>
<span><span class="co">#&gt; for(i in 1:N){</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; # visit 1;</span></span>
<span><span class="co">#&gt; # marginal treatment assignment model, visit 1;</span></span>
<span><span class="co">#&gt; A1s[i] ~ dbern(pA1s[i])</span></span>
<span><span class="co">#&gt; pA1s[i] &lt;- ilogit(bs10)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; # conditional treatment assignment model, visit 1;</span></span>
<span><span class="co">#&gt; A1[i] ~ dbern(pA1[i])</span></span>
<span><span class="co">#&gt; pA1[i] &lt;- ilogit(b10 + b11*L11[i] + b12*L21[i])</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; # visit 2;</span></span>
<span><span class="co">#&gt; # marginal treatment assignment model, visit 2;</span></span>
<span><span class="co">#&gt; A2s[i] ~ dbern(pA2s[i])</span></span>
<span><span class="co">#&gt; pA2s[i] &lt;- ilogit(bs20 + bs21*A1s[i])</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; # conditional treatment assignment model, visit 2;</span></span>
<span><span class="co">#&gt; A2[i] ~ dbern(pA2[i])</span></span>
<span><span class="co">#&gt; pA2[i] &lt;- ilogit(b20 + b21*L11[i] + b22*L21[i] + b23*L12[i] + b24*L22[i] + b25*A1[i])</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; # visit 3;</span></span>
<span><span class="co">#&gt; # marginal treatment assignment model, visit 3;</span></span>
<span><span class="co">#&gt; A3s[i] ~ dbern(pA3s[i])</span></span>
<span><span class="co">#&gt; pA3s[i] &lt;- ilogit(bs30 + bs31*A1s[i] + bs32*A2s[i])</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; # conditional treatment assignment model, visit 3;</span></span>
<span><span class="co">#&gt; A3[i] ~ dbern(pA3[i])</span></span>
<span><span class="co">#&gt; pA3[i] &lt;- ilogit(b30 + b31*L11[i] + b32*L21[i] + b33*L12[i] + b34*L22[i] + b35*A1[i] + b36*L13[i] + b37*L23[i] + b38*A2[i])</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; # export quantity in full posterior specification;</span></span>
<span><span class="co">#&gt; w[i] &lt;- (pA1s[i]*pA2s[i]*pA3s[i])/(pA1[i]*pA2[i]*pA3[i])</span></span>
<span><span class="co">#&gt; }</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; #prior;</span></span>
<span><span class="co">#&gt; bs10~dnorm(0,.01)</span></span>
<span><span class="co">#&gt; b10~dnorm(0,.01)</span></span>
<span><span class="co">#&gt; b11~dnorm(0,.01)</span></span>
<span><span class="co">#&gt; b12~dnorm(0,.01)</span></span>
<span><span class="co">#&gt; bs20~dnorm(0,.01)</span></span>
<span><span class="co">#&gt; bs21~dnorm(0,.01)</span></span>
<span><span class="co">#&gt; b20~dnorm(0,.01)</span></span>
<span><span class="co">#&gt; b21~dnorm(0,.01)</span></span>
<span><span class="co">#&gt; b22~dnorm(0,.01)</span></span>
<span><span class="co">#&gt; b23~dnorm(0,.01)</span></span>
<span><span class="co">#&gt; b24~dnorm(0,.01)</span></span>
<span><span class="co">#&gt; b25~dnorm(0,.01)</span></span>
<span><span class="co">#&gt; bs30~dnorm(0,.01)</span></span>
<span><span class="co">#&gt; bs31~dnorm(0,.01)</span></span>
<span><span class="co">#&gt; bs32~dnorm(0,.01)</span></span>
<span><span class="co">#&gt; b30~dnorm(0,.01)</span></span>
<span><span class="co">#&gt; b31~dnorm(0,.01)</span></span>
<span><span class="co">#&gt; b32~dnorm(0,.01)</span></span>
<span><span class="co">#&gt; b33~dnorm(0,.01)</span></span>
<span><span class="co">#&gt; b34~dnorm(0,.01)</span></span>
<span><span class="co">#&gt; b35~dnorm(0,.01)</span></span>
<span><span class="co">#&gt; b36~dnorm(0,.01)</span></span>
<span><span class="co">#&gt; b37~dnorm(0,.01)</span></span>
<span><span class="co">#&gt; b38~dnorm(0,.01)</span></span>
<span><span class="co">#&gt; }</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="bayesian-non-parametric-bootstrap-to-maximize-the-utility-function-with-respect-to-the-causal-effect-using-bayesmsm">Bayesian non-parametric bootstrap to maximize the utility function
with respect to the causal effect using <code>bayesmsm</code><a class="anchor" aria-label="anchor" href="#bayesian-non-parametric-bootstrap-to-maximize-the-utility-function-with-respect-to-the-causal-effect-using-bayesmsm"></a>
</h2>
<p>The function <code>bayesmsm</code> estimates causal effect of
time-varying treatments. It uses subject-specific treatment assignment
weights <em>weights</em> calculated using <code>bayesweight</code>, and
performs Bayesian non-parametric bootstrap to estimate the causal
parameters.</p>
<ul>
<li>Parameters Description:
<ul>
<li>
<code>ymodel</code>: A formula representing the outcome model, which
can include interactions and functions of covariates.</li>
<li>
<code>nvisit</code>: Specifies the number of visits or time points
considered in the model.</li>
<li>
<code>reference</code>: The baseline or reference intervention
across all visits, typically represented by a vector of zeros indicating
no treatment (default is a vector of all zeros).</li>
<li>
<code>comparator</code>: The comparison intervention across all
visits, typically represented by a vector of ones indicating full
treatment (default is a vector of all ones).</li>
<li>
<code>treatment_effect_type</code>: A character string specifying
the type of treatment effect to estimate. Options are “sq” for
sequential treatment effects, which estimates effects for specific
treatment sequences across visits, and “cum” for cumulative treatment
effects, which assumes a single cumulative treatment variable
representing the total exposure. The default is “sq”.</li>
<li>
<code>family</code>: Specifies the outcome distribution family; use
“gaussian” for continuous outcomes or “binomial” for binary outcomes
(default is “gaussian”).</li>
<li>
<code>data</code>: The dataset containing all variables required for
the model.</li>
<li>
<code>wmean</code>: A vector of treatment assignment weights.
Default is a vector of ones, implying equal weighting.</li>
<li>
<code>nboot</code>: The number of bootstrap iterations to perform
for estimating the uncertainty around the causal estimates.</li>
<li>
<code>optim_method</code>: The optimization method used to find the
best parameters in the model (default is ‘BFGS’).</li>
<li>
<code>seed</code>: A seed value to ensure reproducibility of
results.</li>
<li>
<code>parallel</code>: A logical flag indicating whether to perform
computations in parallel (default is TRUE).</li>
<li>
<code>ncore</code>: The number of cores to use for parallel
computation (default is 4).</li>
</ul>
</li>
</ul>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bayesmsm.html">bayesmsm</a></span><span class="op">(</span>ymodel <span class="op">=</span> <span class="va">Y</span> <span class="op">~</span> <span class="va">A1</span> <span class="op">+</span> <span class="va">A2</span> <span class="op">+</span> <span class="va">A3</span>,</span>
<span>  nvisit <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  reference <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">3</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  comparator <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">3</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  family <span class="op">=</span> <span class="st">"binomial"</span>,</span>
<span>  data <span class="op">=</span> <span class="va">simdat</span>,</span>
<span>  wmean <span class="op">=</span> <span class="va">weights</span><span class="op">$</span><span class="va">weights</span>,</span>
<span>  nboot <span class="op">=</span> <span class="fl">50</span>,</span>
<span>  optim_method <span class="op">=</span> <span class="st">"BFGS"</span>,</span>
<span>  parallel <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  seed <span class="op">=</span> <span class="fl">890123</span>,</span>
<span>  ncore <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 12</span></span>
<span><span class="co">#&gt;  $ RD_mean    : num 0.267</span></span>
<span><span class="co">#&gt;  $ RR_mean    : num 1.7</span></span>
<span><span class="co">#&gt;  $ OR_mean    : num 3.25</span></span>
<span><span class="co">#&gt;  $ RD_sd      : num 0.0881</span></span>
<span><span class="co">#&gt;  $ RR_sd      : num 0.308</span></span>
<span><span class="co">#&gt;  $ OR_sd      : num 1.15</span></span>
<span><span class="co">#&gt;  $ RD_quantile: Named num [1:2] 0.0996 0.3936</span></span>
<span><span class="co">#&gt;   ..- attr(*, "names")= chr [1:2] "2.5%" "97.5%"</span></span>
<span><span class="co">#&gt;  $ RR_quantile: Named num [1:2] 1.19 2.2</span></span>
<span><span class="co">#&gt;   ..- attr(*, "names")= chr [1:2] "2.5%" "97.5%"</span></span>
<span><span class="co">#&gt;  $ OR_quantile: Named num [1:2] 1.5 5.31</span></span>
<span><span class="co">#&gt;   ..- attr(*, "names")= chr [1:2] "2.5%" "97.5%"</span></span>
<span><span class="co">#&gt;  $ bootdata   :'data.frame': 50 obs. of  5 variables:</span></span>
<span><span class="co">#&gt;   ..$ effect_reference : num [1:50] -0.688 -0.35 -0.205 -0.241 -0.644 ...</span></span>
<span><span class="co">#&gt;   ..$ effect_comparator: num [1:50] 0.825 0.662 0.794 0.594 0.738 ...</span></span>
<span><span class="co">#&gt;   ..$ RD               : num [1:50] 0.361 0.246 0.24 0.204 0.332 ...</span></span>
<span><span class="co">#&gt;   ..$ RR               : num [1:50] 2.08 1.6 1.53 1.46 1.96 ...</span></span>
<span><span class="co">#&gt;   ..$ OR               : num [1:50] 4.54 2.75 2.71 2.3 3.98 ...</span></span>
<span><span class="co">#&gt;  $ reference  : num [1:3] 0 0 0</span></span>
<span><span class="co">#&gt;  $ comparator : num [1:3] 1 1 1</span></span></code></pre></div>
<ul>
<li>It returns a model object which contains:
<ul>
<li>
<code>mean</code>, <code>sd</code>, <code>quantile</code>: the mean,
standard deviation and 95% credible interval of the estimated causal
effect (ATE). From the above results, the mean of ATE is approximately
-3.161, which indicates that the expected outcome for always treated
patients is, on average, 3.161 units less than that for never treated
patients.</li>
<li>
<code>bootdata</code>: a data frame containing the bootstrap samples
for the reference effect, comparator effect, and average treatment
effect (ATE).</li>
<li>
<code>reference</code>, <code>comparator</code>: the reference level
and comparator level the user chooses to compare. Here the reference
level is never treated (0,0), and the comparator level is always treated
(1,1).</li>
</ul>
</li>
<li>Summary function to generate result table from <code>bayesmsm</code>
<ul>
<li>The <code>summary_bayesmsm</code> function automatically generates a
summary table of the model output from the function
<code>bayesmsm</code>.</li>
</ul>
</li>
</ul>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/summary_bayesmsm.html">summary_bayesmsm</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span></span>
<span><span class="co">#&gt;                  mean         sd        2.5%      97.5%</span></span>
<span><span class="co">#&gt; Reference  -0.3766267 0.24858666 -0.73523404 0.08280509</span></span>
<span><span class="co">#&gt; Comparator  0.7353032 0.16984321  0.37567473 1.03664853</span></span>
<span><span class="co">#&gt; RD          0.2666920 0.08806894  0.09960435 0.39356843</span></span>
<span><span class="co">#&gt; RR          1.6960045 0.30769599  1.19152472 2.19875816</span></span>
<span><span class="co">#&gt; OR          3.2472734 1.14662787  1.50441552 5.31202552</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="visualization-functions-plot_ate-plot_apo-plot_est_box">Visualization functions: <code>plot_ATE</code>,
<code>plot_APO</code>, <code>plot_est_box</code><a class="anchor" aria-label="anchor" href="#visualization-functions-plot_ate-plot_apo-plot_est_box"></a>
</h2>
<p>The <code>bayesmsm</code> package also provides several other
functions for visualizing the above results: <code>plot_ATE</code>,
<code>plot_APO</code>, and <code>plot_est_box</code>. These functions
help the user better interpret the estimated causal effects.</p>
<ul>
<li>Plotting the Average Treatment Effect (ATE)
<ul>
<li>The <code>plot_ATE</code> function generates a plot of the estimated
ATE with its 95% credible interval.</li>
</ul>
</li>
</ul>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_ATE.html">plot_ATE</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span></span></code></pre></div>
<p><img src="bayesmsm-nocensoring_files/figure-html/unnamed-chunk-9-1.png" width="864" style="display: block; margin: auto;"></p>
<ul>
<li>Plotting the Average Potential Outcome (APO)
<ul>
<li>Similarly, the <code>plot_APO</code> function plots the estimated
APO for both the reference and comparator level effects.</li>
</ul>
</li>
</ul>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_APO.html">plot_APO</a></span><span class="op">(</span><span class="va">model</span>, <span class="st">"effect_reference"</span><span class="op">)</span></span></code></pre></div>
<p><img src="bayesmsm-nocensoring_files/figure-html/unnamed-chunk-10-1.png" width="864" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_APO.html">plot_APO</a></span><span class="op">(</span><span class="va">model</span>, <span class="st">"effect_comparator"</span><span class="op">)</span></span></code></pre></div>
<p><img src="bayesmsm-nocensoring_files/figure-html/unnamed-chunk-10-2.png" width="864" style="display: block; margin: auto;"></p>
<ul>
<li>Plotting the Distribution of Estimated Treatment Effects
<ul>
<li>The <code>plot_est_box</code> function generates an error bar plot
of the estimated treatment effects (APO and ATE) from the bootstrap
samples.</li>
</ul>
</li>
</ul>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_est_box.html">plot_est_box</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span></span></code></pre></div>
<p><img src="bayesmsm-nocensoring_files/figure-html/unnamed-chunk-11-1.png" width="864" style="display: block; margin: auto;"></p>
</div>
<div class="section level2">
<h2 id="reference">Reference<a class="anchor" aria-label="anchor" href="#reference"></a>
</h2>
<ul>
<li>Saarela, O., Stephens, D. A., Moodie, E. E. M., &amp; Klein, M. B.
(2015). On Bayesian estimation of marginal structural models.
Biometrics, 71(2), 279–288. <a href="https://doi.org/10.1111/biom.12269" class="external-link uri">https://doi.org/10.1111/biom.12269</a>
</li>
<li>Robins, J. M., Hernán, M. A., &amp; Brumback, B. (2000). Marginal
structural models and causal inference in epidemiology. Epidemiology,
11(5), 550–560. <a href="https://doi.org/10.1097/00001648-200009000-00011" class="external-link uri">https://doi.org/10.1097/00001648-200009000-00011</a>
</li>
<li>Liu, K., Saarela, O., Feldman, B. M., &amp; Pullenayegum, E. (2020).
Estimation of causal effects with repeatedly measured outcomes in a
Bayesian framework. Statistical Methods in Medical Research, 29(9),
2507–2519. <a href="https://doi.org/10.1177/0962280219900362" class="external-link uri">https://doi.org/10.1177/0962280219900362</a>
</li>
</ul>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Kuan Liu, Xiao Yan, Martin Urner.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
