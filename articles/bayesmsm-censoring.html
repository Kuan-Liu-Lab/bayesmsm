<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>`bayesmsm` for longitudinal data with informative right-censoring • bayesmsm</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="`bayesmsm` for longitudinal data with informative right-censoring">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">bayesmsm</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/bayesmsm-censoring.html">`bayesmsm` for longitudinal data with informative right-censoring</a></li>
    <li><a class="dropdown-item" href="../articles/bayesmsm-nocensoring.html">`bayesmsm` for longitudinal data without right-censoring</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/Kuan-Liu-Lab/bayesmsm/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>`bayesmsm` for longitudinal data with informative right-censoring</h1>
                        <h4 data-toc-skip class="author">Xiao Yan, Kuan
Liu</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/Kuan-Liu-Lab/bayesmsm/blob/main/vignettes/bayesmsm-censoring.Rmd" class="external-link"><code>vignettes/bayesmsm-censoring.Rmd</code></a></small>
      <div class="d-none name"><code>bayesmsm-censoring.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<ul>
<li>
<p>The <code>bayesmsm</code> package enables easy implementation of
the Bayesian marginal structural models (BMSMs) for longitudinal data.
The methodology of BMSMs can be divided into 2 estimation steps:</p>
<ul>
<li>Step 1. Bayesian treatment effect weight estimation</li>
<li>Step 2. Bayesian non-parametric bootstrap to maximize the utility
function with respect to the causal effect</li>
</ul>
</li>
<li><p>For Step 1, we estimate treatment weights
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>w</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><annotation encoding="application/x-tex">w_{ij}</annotation></semantics></math>
using posterior samples of the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>α</mi><annotation encoding="application/x-tex">\alpha</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>β</mi><annotation encoding="application/x-tex">\beta</annotation></semantics></math>
via fitting a series of logistic regressions in a Bayesian framework.
The package is able to handle longitudinal data without and with
right-censoring. For Step 2,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>P</mi><mi>n</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>v</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">P_n(v_{ij})</annotation></semantics></math>
is estimated via non-parametric Bayesian bootstrap with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>D</mi><mi>i</mi><mi>r</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>,</mo><mi>.</mi><mi>.</mi><mi>.</mi><mo>,</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">Dir(1,...,1)</annotation></semantics></math>
sampling weights.</p></li>
<li>
<p>The main functions in this package include:</p>
<ul>
<li>
<code>bayesweight</code>: Calculates Bayesian weights for
subject-specific treatment effects.</li>
<li>
<code>bayesweight_cen</code>: Calculates Bayesian weights for
subject-specific treatment effects with right-censored data.</li>
<li>
<code>bayesmsm</code>: Estimates marginal structural models using
the calculated Bayesian weights.</li>
<li>
<code>plot_ATE</code>: Plots the estimated Average Treatment Effect
(ATE).</li>
<li>
<code>plot_APO</code>: Plots the estimated Average Potential Outcome
(APO).</li>
<li>
<code>plot_est_box</code>: Plots the distribution of estimated
treatment effects.</li>
<li>
<code>summary_bayesmsm</code>: Summarizes the model results from
<code>bayesmsm</code>.</li>
<li>
<code>simData</code>: Generates synthetic longitudinal data with
optional right-censoring</li>
</ul>
</li>
<li>
<p>Installation</p>
<ul>
<li>To install the bayesmsm package, you can use the
<code>devtools</code> package to install it directly from GitHub.</li>
</ul>
</li>
</ul>
</div>
<div class="section level2">
<h2 id="simulated-longitudinal-observational-data-with-right-censoring">Simulated longitudinal observational data with right-censoring<a class="anchor" aria-label="anchor" href="#simulated-longitudinal-observational-data-with-right-censoring"></a>
</h2>
<p>In this vignette, we demonstrate how to simulate a longitudinal
dataset that replicates features of real-world clinical studies with
right-censoring using <code><a href="../reference/simData.html">simData()</a></code>. Here, we generate data for
<strong>200</strong> individuals observed over <strong>2</strong>
visits. At each visit, two normally distributed covariates
(<code>L1_j</code>, <code>L2_j</code>) and a binary treatment assignment
(<code>A_j</code>) are created. Right-censoring is induced at each visit
via a logistic model (<code>C_j</code>), and once an individual is
censored at visit <em>j</em>, all subsequent covariates, treatments, and
the end-of-study outcome <em>Y</em> are set to <code>NA</code>. The
outcome <em>Y</em> is binary, drawn from a logistic regression on the
full covariate and treatment history.</p>
<table class="table">
<thead><tr class="header">
<th>Variable</th>
<th>Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>
<code>L1_1</code>, <code>L2_1</code>
</td>
<td>Baseline covariates (continuous)</td>
</tr>
<tr class="even">
<td>
<code>L1_2</code>, <code>L2_2</code>
</td>
<td>Time-varying covariates at visit 2</td>
</tr>
<tr class="odd">
<td>
<code>A1</code>, <code>A2</code>
</td>
<td>Binary treatments at visits 1 and 2</td>
</tr>
<tr class="even">
<td>
<code>C1</code>, <code>C2</code>
</td>
<td>Right-censoring indicators at each visit</td>
</tr>
<tr class="odd">
<td><code>Y</code></td>
<td>Binary end-of-study outcome (1 = event)</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 1) Define coefficient lists for 2 visits</span></span>
<span><span class="va">amodel</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  <span class="co"># Visit 1: logit P(A1=1) = -0.3 + 0.4*L1_1 - 0.2*L2_1</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"(Intercept)"</span> <span class="op">=</span> <span class="op">-</span><span class="fl">0.3</span>, <span class="st">"L1_1"</span> <span class="op">=</span> <span class="fl">0.4</span>, <span class="st">"L2_1"</span> <span class="op">=</span> <span class="op">-</span><span class="fl">0.2</span><span class="op">)</span>,</span>
<span>  <span class="co"># Visit 2: logit P(A2=1) = -0.1 + 0.3*L1_2 - 0.1*L2_2 + 0.5*A_prev</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"(Intercept)"</span> <span class="op">=</span> <span class="op">-</span><span class="fl">0.1</span>, <span class="st">"L1_2"</span> <span class="op">=</span> <span class="fl">0.3</span>, <span class="st">"L2_2"</span> <span class="op">=</span> <span class="op">-</span><span class="fl">0.1</span>, <span class="st">"A_prev"</span> <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 2) Define outcome model: logistic on treatments and last covariates</span></span>
<span><span class="va">ymodel</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  <span class="st">"(Intercept)"</span> <span class="op">=</span> <span class="op">-</span><span class="fl">0.8</span>,</span>
<span>  <span class="st">"A1"</span>          <span class="op">=</span> <span class="fl">0.2</span>,</span>
<span>  <span class="st">"A2"</span>          <span class="op">=</span> <span class="fl">0.4</span>,</span>
<span>  <span class="st">"L1_2"</span>        <span class="op">=</span> <span class="fl">0.3</span>,</span>
<span>  <span class="st">"L2_2"</span>        <span class="op">=</span> <span class="op">-</span><span class="fl">0.3</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 3) Define right-censoring models at each visit</span></span>
<span><span class="va">cmodel</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  <span class="co"># Censor at visit 1 based on baseline covariates and A1</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"(Intercept)"</span> <span class="op">=</span> <span class="op">-</span><span class="fl">1.5</span>, <span class="st">"L1_1"</span> <span class="op">=</span> <span class="fl">0.2</span>, <span class="st">"L2_1"</span> <span class="op">=</span> <span class="op">-</span><span class="fl">0.2</span>, <span class="st">"A"</span> <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span>,</span>
<span>  <span class="co"># Censor at visit 2 based on visit-2 covariates and A2</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"(Intercept)"</span> <span class="op">=</span> <span class="op">-</span><span class="fl">1.5</span>, <span class="st">"L1_2"</span> <span class="op">=</span> <span class="fl">0.1</span>, <span class="st">"L2_2"</span> <span class="op">=</span> <span class="op">-</span><span class="fl">0.1</span>, <span class="st">"A"</span> <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 4) Load package and simulate data</span></span>
<span><span class="va">simdat_cen</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simData.html">simData</a></span><span class="op">(</span></span>
<span>  n                <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  n_visits         <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  covariate_counts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>  amodel           <span class="op">=</span> <span class="va">amodel</span>,</span>
<span>  ymodel           <span class="op">=</span> <span class="va">ymodel</span>,</span>
<span>  y_type           <span class="op">=</span> <span class="st">"binary"</span>,</span>
<span>  right_censor     <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  cmodel           <span class="op">=</span> <span class="va">cmodel</span>,</span>
<span>  seed             <span class="op">=</span> <span class="fl">123</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 5) Inspect first rows</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">simdat_cen</span><span class="op">)</span></span>
<span><span class="co">#&gt;          L1_1        L2_1 A1 C1       L1_2        L2_2 A2 C2  Y</span></span>
<span><span class="co">#&gt; 1 -0.56047565 -0.71040656  1  0 -0.7152422 -0.07355602  1  1 NA</span></span>
<span><span class="co">#&gt; 2 -0.23017749  0.25688371  0  0 -0.7526890 -1.16865142  1  0  1</span></span>
<span><span class="co">#&gt; 3  1.55870831 -0.24669188  0  0 -0.9385387 -0.63474826  0  0  0</span></span>
<span><span class="co">#&gt; 4  0.07050839 -0.34754260  1  0 -1.0525133 -0.02884155  0  0  1</span></span>
<span><span class="co">#&gt; 5  0.12928774 -0.95161857  0  0 -0.4371595  0.67069597  1  1 NA</span></span>
<span><span class="co">#&gt; 6  1.71506499 -0.04502772  1  0  0.3311792 -1.65054654  1  0  0</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="bayesian-treatment-effect-weight-estimation-using-bayesweight_cen">Bayesian treatment effect weight estimation using
<code>bayesweight_cen</code><a class="anchor" aria-label="anchor" href="#bayesian-treatment-effect-weight-estimation-using-bayesweight_cen"></a>
</h2>
<p>Next, we use the <code>bayesweight_cen</code> function to estimate
the weights with censoring. We specify the treatment and censoring
models for each time point, including the relevant covariates.</p>
<ul>
<li>Parameters Description:
<ul>
<li>
<code>trtmodel.list</code>: A list of formulas corresponding to each
time point with the time-specific treatment variable on the left hand
side and pre-treatment covariates to be balanced on the right hand side.
Interactions and functions of covariates are allowed.</li>
<li>
<code>cenmodel.list</code>: A list of formulas of the censoring
model with the censoring indicators on the left hand side and the
covariates prior to the censoring indicators on the right hand
side.</li>
<li>
<code>data</code>: The dataset containing all the variables
specified in trtmodel.list.</li>
<li>
<code>n.chains</code>: Number of MCMC chains to run. For
non-parallel execution, this should be set to 1. For parallel execution,
it requires at least 2 chains.</li>
<li>
<code>n.iter</code>: Total number of iterations for each chain
(including burn-in).</li>
<li>
<code>n.burnin</code>: Number of iterations to discard at the
beginning of the simulation (burn-in).</li>
<li>
<code>n.thin</code>: Thinning rate for the MCMC sampler.</li>
<li>
<code>seed</code>: Seed to ensure reproducibility.</li>
<li>
<code>parallel</code>: Logical flag indicating whether to run the
MCMC chains in parallel. Default is TRUE.</li>
</ul>
</li>
</ul>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">weights_cen</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bayesweight_cen.html">bayesweight_cen</a></span><span class="op">(</span></span>
<span>  trtmodel.list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="va">A1</span> <span class="op">~</span> <span class="va">L1_1</span> <span class="op">+</span> <span class="va">L2_1</span>,</span>
<span>    <span class="va">A2</span> <span class="op">~</span> <span class="va">L1_2</span> <span class="op">+</span> <span class="va">L2_2</span> <span class="op">+</span> <span class="va">A1</span><span class="op">)</span>,</span>
<span>  cenmodel.list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="va">C1</span> <span class="op">~</span> <span class="va">L1_1</span> <span class="op">+</span> <span class="va">L2_1</span> <span class="op">+</span> <span class="va">A1</span>,</span>
<span>    <span class="va">C2</span> <span class="op">~</span> <span class="va">L1_2</span> <span class="op">+</span> <span class="va">L2_2</span> <span class="op">+</span> <span class="va">A2</span><span class="op">)</span>,</span>
<span>  data <span class="op">=</span> <span class="va">simdat_cen</span>,</span>
<span>  n.chains <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  n.iter <span class="op">=</span> <span class="fl">200</span>,</span>
<span>  n.burnin <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  n.thin <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  seed <span class="op">=</span> <span class="fl">890123</span>,</span>
<span>  parallel <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Compiling model graph</span></span>
<span><span class="co">#&gt;    Resolving undeclared variables</span></span>
<span><span class="co">#&gt;    Allocating nodes</span></span>
<span><span class="co">#&gt; Graph information:</span></span>
<span><span class="co">#&gt;    Observed stochastic nodes: 700</span></span>
<span><span class="co">#&gt;    Unobserved stochastic nodes: 21</span></span>
<span><span class="co">#&gt;    Total graph size: 2495</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Initializing model</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">weights_cen</span><span class="op">$</span><span class="va">weights</span><span class="op">)</span></span>
<span><span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's </span></span>
<span><span class="co">#&gt;  0.6241  1.2029  1.9547  2.7377  2.9418 18.9279      25</span></span></code></pre></div>
<p>Similarly, the function will automatically run MCMC with JAGS based
on the specified treatment and censoring model inputs, generating a JAGS
model string as part of the function output. The function returns a list
containing the updated weights for subject-specific treatment and
censoring effects as well as the JAGS model.</p>
<ul>
<li>We can print and view the JAGS model stored in
<code>model_string</code> from the above function output:</li>
</ul>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="va">weights_cen</span><span class="op">$</span><span class="va">model_string</span><span class="op">)</span></span>
<span><span class="co">#&gt; model{</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; for (i in 1:N1) {</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; # conditional model;</span></span>
<span><span class="co">#&gt; A1[i] ~ dbern(p1[i])</span></span>
<span><span class="co">#&gt; logit(p1[i]) &lt;- b10 + b11*L1_1[i] + b12*L2_1[i]</span></span>
<span><span class="co">#&gt; C1[i] ~ dbern(cp1[i])</span></span>
<span><span class="co">#&gt; logit(cp1[i]) &lt;- s10 + s11*L1_1[i] + s12*L2_1[i] + s13*A1[i]</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; # marginal model;</span></span>
<span><span class="co">#&gt; A1s[i] ~ dbern(p1s[i])</span></span>
<span><span class="co">#&gt; logit(p1s[i]) &lt;- bs10</span></span>
<span><span class="co">#&gt; C1s[i] ~ dbern(cp1s[i])</span></span>
<span><span class="co">#&gt; logit(cp1s[i]) &lt;- ts10</span></span>
<span><span class="co">#&gt; }</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; for (i in 1:N2) {</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; # conditional model;</span></span>
<span><span class="co">#&gt; A2[i] ~ dbern(p2[i])</span></span>
<span><span class="co">#&gt; logit(p2[i]) &lt;- b20 + b21*L1_2[i] + b22*L2_2[i] + b23*A1[i]</span></span>
<span><span class="co">#&gt; C2[i] ~ dbern(cp2[i])</span></span>
<span><span class="co">#&gt; logit(cp2[i]) &lt;- s20 + s21*L1_2[i] + s22*L2_2[i] + s23*A2[i]</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; # marginal model;</span></span>
<span><span class="co">#&gt; A2s[i] ~ dbern(p2s[i])</span></span>
<span><span class="co">#&gt; logit(p2s[i]) &lt;- bs20 + bs21*A1s[i]</span></span>
<span><span class="co">#&gt; C2s[i] ~ dbern(cp2s[i])</span></span>
<span><span class="co">#&gt; logit(cp2s[i]) &lt;- ts20 + ts21*A1s[i]</span></span>
<span><span class="co">#&gt; }</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; # Priors</span></span>
<span><span class="co">#&gt; b10 ~ dunif(-10, 10)</span></span>
<span><span class="co">#&gt; b11 ~ dunif(-10, 10)</span></span>
<span><span class="co">#&gt; b12 ~ dunif(-10, 10)</span></span>
<span><span class="co">#&gt; s10 ~ dunif(-10, 10)</span></span>
<span><span class="co">#&gt; s11 ~ dunif(-10, 10)</span></span>
<span><span class="co">#&gt; s12 ~ dunif(-10, 10)</span></span>
<span><span class="co">#&gt; s13 ~ dunif(-10, 10)</span></span>
<span><span class="co">#&gt; bs10 ~ dunif(-10, 10)</span></span>
<span><span class="co">#&gt; ts10 ~ dunif(-10, 10)</span></span>
<span><span class="co">#&gt; b20 ~ dunif(-10, 10)</span></span>
<span><span class="co">#&gt; b21 ~ dunif(-10, 10)</span></span>
<span><span class="co">#&gt; b22 ~ dunif(-10, 10)</span></span>
<span><span class="co">#&gt; b23 ~ dunif(-10, 10)</span></span>
<span><span class="co">#&gt; s20 ~ dunif(-10, 10)</span></span>
<span><span class="co">#&gt; s21 ~ dunif(-10, 10)</span></span>
<span><span class="co">#&gt; s22 ~ dunif(-10, 10)</span></span>
<span><span class="co">#&gt; s23 ~ dunif(-10, 10)</span></span>
<span><span class="co">#&gt; bs20 ~ dunif(-10, 10)</span></span>
<span><span class="co">#&gt; bs21 ~ dunif(-10, 10)</span></span>
<span><span class="co">#&gt; ts20 ~ dunif(-10, 10)</span></span>
<span><span class="co">#&gt; ts21 ~ dunif(-10, 10)</span></span>
<span><span class="co">#&gt; }</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="bayesian-non-parametric-bootstrap-to-maximize-the-utility-function-with-respect-to-the-causal-effect-using-bayesmsm">Bayesian non-parametric bootstrap to maximize the utility function
with respect to the causal effect using <code>bayesmsm</code><a class="anchor" aria-label="anchor" href="#bayesian-non-parametric-bootstrap-to-maximize-the-utility-function-with-respect-to-the-causal-effect-using-bayesmsm"></a>
</h2>
<p>Using the weights estimated by <code>bayesweight_cen</code>, we now
fit the Bayesian Marginal Structural Model and estimate the marginal
treatment effects using the <code>bayesmsm</code> function as before. We
specify the outcome model and other relevant parameters.</p>
<ul>
<li>Parameters Description:
<ul>
<li>
<code>ymodel</code>: A formula representing the outcome model, which
can include interactions and functions of covariates.</li>
<li>
<code>nvisit</code>: Specifies the number of visits or time points
considered in the model.</li>
<li>
<code>reference</code>: The baseline or reference intervention
across all visits, typically represented by a vector of zeros indicating
no treatment (default is a vector of all zeros).</li>
<li>
<code>comparator</code>: The comparison intervention across all
visits, typically represented by a vector of ones indicating full
treatment (default is a vector of all ones).</li>
<li>
<code>treatment_effect_type</code>: A character string specifying
the type of treatment effect to estimate. Options are “sq” for
sequential treatment effects, which estimates effects for specific
treatment sequences across visits, and “cum” for cumulative treatment
effects, which assumes a single cumulative treatment variable
representing the total exposure. The default is “sq”.</li>
<li>
<code>family</code>: Specifies the outcome distribution family; use
“gaussian” for continuous outcomes or “binomial” for binary outcomes
(default is “gaussian”).</li>
<li>
<code>data</code>: The dataset containing all variables required for
the model.</li>
<li>
<code>wmean</code>: A vector of treatment assignment weights.
Default is a vector of ones, implying equal weighting.</li>
<li>
<code>nboot</code>: The number of bootstrap iterations to perform
for estimating the uncertainty around the causal estimates.</li>
<li>
<code>optim_method</code>: The optimization method used to find the
best parameters in the model (default is ‘BFGS’).</li>
<li>
<code>seed</code>: A seed value to ensure reproducibility of
results.</li>
<li>
<code>parallel</code>: A logical flag indicating whether to perform
computations in parallel (default is TRUE).</li>
<li>
<code>ncore</code>: The number of cores to use for parallel
computation (default is 4).</li>
</ul>
</li>
</ul>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Remove all NAs (censored observations) from the original dataset and weights</span></span>
<span><span class="va">simdat_cen</span><span class="op">$</span><span class="va">weights</span> <span class="op">&lt;-</span> <span class="va">weights_cen</span><span class="op">$</span><span class="va">weights</span></span>
<span><span class="va">simdat_cen2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/na.fail.html" class="external-link">na.omit</a></span><span class="op">(</span><span class="va">simdat_cen</span><span class="op">)</span></span>
<span></span>
<span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bayesmsm.html">bayesmsm</a></span><span class="op">(</span>ymodel <span class="op">=</span> <span class="va">Y</span> <span class="op">~</span> <span class="va">A1</span> <span class="op">+</span> <span class="va">A2</span>,</span>
<span>  nvisit <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  reference <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  comparator <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  family <span class="op">=</span> <span class="st">"binomial"</span>,</span>
<span>  data <span class="op">=</span> <span class="va">simdat_cen2</span>,</span>
<span>  wmean <span class="op">=</span> <span class="va">simdat_cen2</span><span class="op">$</span><span class="va">weights</span>,</span>
<span>  nboot <span class="op">=</span> <span class="fl">50</span>,</span>
<span>  optim_method <span class="op">=</span> <span class="st">"BFGS"</span>,</span>
<span>  parallel <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  seed <span class="op">=</span> <span class="fl">890123</span>,</span>
<span>  ncore <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 12</span></span>
<span><span class="co">#&gt;  $ RD_mean    : num 0.146</span></span>
<span><span class="co">#&gt;  $ RR_mean    : num 2.51</span></span>
<span><span class="co">#&gt;  $ OR_mean    : num 4.36</span></span>
<span><span class="co">#&gt;  $ RD_sd      : num 0.22</span></span>
<span><span class="co">#&gt;  $ RR_sd      : num 2.25</span></span>
<span><span class="co">#&gt;  $ OR_sd      : num 5.96</span></span>
<span><span class="co">#&gt;  $ RD_quantile: Named num [1:2] -0.215 0.516</span></span>
<span><span class="co">#&gt;   ..- attr(*, "names")= chr [1:2] "2.5%" "97.5%"</span></span>
<span><span class="co">#&gt;  $ RR_quantile: Named num [1:2] 0.453 8.895</span></span>
<span><span class="co">#&gt;   ..- attr(*, "names")= chr [1:2] "2.5%" "97.5%"</span></span>
<span><span class="co">#&gt;  $ OR_quantile: Named num [1:2] 0.345 15.914</span></span>
<span><span class="co">#&gt;   ..- attr(*, "names")= chr [1:2] "2.5%" "97.5%"</span></span>
<span><span class="co">#&gt;  $ bootdata   :'data.frame': 50 obs. of  5 variables:</span></span>
<span><span class="co">#&gt;   ..$ effect_reference : num [1:50] -0.791 -0.651 -0.741 -0.877 -1.844 ...</span></span>
<span><span class="co">#&gt;   ..$ effect_comparator: num [1:50] -1.098 -1.939 -0.379 -1.481 -0.831 ...</span></span>
<span><span class="co">#&gt;   ..$ RD               : num [1:50] -0.0619 -0.2169 0.0835 -0.1085 0.1669 ...</span></span>
<span><span class="co">#&gt;   ..$ RR               : num [1:50] 0.802 0.367 1.259 0.631 2.222 ...</span></span>
<span><span class="co">#&gt;   ..$ OR               : num [1:50] 0.736 0.276 1.436 0.547 2.755 ...</span></span>
<span><span class="co">#&gt;  $ reference  : num [1:2] 0 0</span></span>
<span><span class="co">#&gt;  $ comparator : num [1:2] 1 1</span></span></code></pre></div>
<p>The <code>bayesmsm</code> function returns a model object containing
the following: the mean, standard deviation, and 95% credible interval
of the Risk Difference (RD), Risk Ratio (RR), and Odds Ratio (OR). It
also includes a data frame containing the bootstrap samples for the
reference effect, comparator effect, RD, RR, and OR, as well as the
reference and comparator levels chosen by the user.</p>
<ul>
<li>Summary function to generate result table from <code>bayesmsm</code>
<ul>
<li>The <code>summary_bayesmsm</code> function automatically generates a
summary table of the model output from the function
<code>bayesmsm</code>.</li>
</ul>
</li>
</ul>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/summary_bayesmsm.html">summary_bayesmsm</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span></span>
<span><span class="co">#&gt;                  mean        sd       2.5%      97.5%</span></span>
<span><span class="co">#&gt; Reference  -1.4320309 0.6712919 -2.7921195 -0.1847785</span></span>
<span><span class="co">#&gt; Comparator -0.6362027 0.6711850 -1.7496915  0.5551147</span></span>
<span><span class="co">#&gt; RD          0.1463972 0.2199628 -0.2150885  0.5155204</span></span>
<span><span class="co">#&gt; RR          2.5137979 2.2490552  0.4526227  8.8946165</span></span>
<span><span class="co">#&gt; OR          4.3640132 5.9617061  0.3449483 15.9140163</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="visualization-functions-plot_ate-plot_apo-plot_est_box">Visualization functions: <code>plot_ATE</code>,
<code>plot_APO</code>, <code>plot_est_box</code><a class="anchor" aria-label="anchor" href="#visualization-functions-plot_ate-plot_apo-plot_est_box"></a>
</h2>
<p>Similarly, we can use the built-in functions as well as
<code>summary_bayesmsm</code> to visualize and summarize the
results.</p>
<ul>
<li>Plotting the Average Treatment Effect (ATE)
<ul>
<li>The <code>plot_ATE</code> function generates a plot of the estimated
ATE with its 95% credible interval.</li>
</ul>
</li>
</ul>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_ATE.html">plot_ATE</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span></span></code></pre></div>
<p><img src="bayesmsm-censoring_files/figure-html/unnamed-chunk-8-1.png" width="864" style="display: block; margin: auto;"></p>
<ul>
<li>Plotting the Average Potential Outcome (APO)
<ul>
<li>The <code>plot_APO</code> function plots the estimated APO for both
the reference and comparator level effects.</li>
</ul>
</li>
</ul>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_APO.html">plot_APO</a></span><span class="op">(</span><span class="va">model</span>, effect_type <span class="op">=</span> <span class="st">"effect_comparator"</span><span class="op">)</span></span></code></pre></div>
<p><img src="bayesmsm-censoring_files/figure-html/unnamed-chunk-9-1.png" width="864" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_APO.html">plot_APO</a></span><span class="op">(</span><span class="va">model</span>, effect_type <span class="op">=</span> <span class="st">"effect_reference"</span><span class="op">)</span></span></code></pre></div>
<p><img src="bayesmsm-censoring_files/figure-html/unnamed-chunk-9-2.png" width="864" style="display: block; margin: auto;"></p>
<ul>
<li>Plotting the Distribution of Estimated Treatment Effects
<ul>
<li>The <code>plot_est_box</code> function generates an error bar plot
of the estimated treatment effects (APO and ATE) from the bootstrap
samples.</li>
</ul>
</li>
</ul>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_est_box.html">plot_est_box</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span></span></code></pre></div>
<p><img src="bayesmsm-censoring_files/figure-html/unnamed-chunk-10-1.png" width="864" style="display: block; margin: auto;"></p>
</div>
<div class="section level2">
<h2 id="reference">Reference<a class="anchor" aria-label="anchor" href="#reference"></a>
</h2>
<ul>
<li>Saarela, O., Stephens, D. A., Moodie, E. E. M., &amp; Klein, M. B.
(2015). On Bayesian estimation of marginal structural models.
Biometrics, 71(2), 279–288. <a href="https://doi.org/10.1111/biom.12269" class="external-link uri">https://doi.org/10.1111/biom.12269</a>
</li>
<li>Robins, J. M., Hernán, M. A., &amp; Brumback, B. (2000). Marginal
structural models and causal inference in epidemiology. Epidemiology,
11(5), 550–560. <a href="https://doi.org/10.1097/00001648-200009000-00011" class="external-link uri">https://doi.org/10.1097/00001648-200009000-00011</a>
</li>
<li>Liu, K., Saarela, O., Feldman, B. M., &amp; Pullenayegum, E. (2020).
Estimation of causal effects with repeatedly measured outcomes in a
Bayesian framework. Statistical Methods in Medical Research, 29(9),
2507–2519. <a href="https://doi.org/10.1177/0962280219900362" class="external-link uri">https://doi.org/10.1177/0962280219900362</a>
</li>
</ul>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Kuan Liu, Xiao Yan, Martin Urner.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
